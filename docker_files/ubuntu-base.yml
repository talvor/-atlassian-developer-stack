FROM ubuntu:18.04

ARG USER=docker
ARG UID=1000
ARG GID=1000
ARG DATA_DIR=/data
ARG GIT_HOST=
ARG GIT_REPO=

# Update & Upgrade system
RUN apt-get -y update && apt-get -y upgrade

# Install dependencies
RUN apt-get -y install ssh sudo git

# Make sure we have bash as our default shell
RUN rm /bin/sh && ln -s /bin/bash /bin/sh

# Create user
RUN useradd -m ${USER} --uid=${UID}
RUN passwd -d ${USER}
RUN adduser ${USER} sudo

RUN mkdir -p /home/${USER}/.atlassian/asd
COPY setup.sh /home/${USER}/.atlassian/asd/

# Setup default user, when enter docker container
USER ${UID}:${GID}
WORKDIR /home/${USER}/data

# Link host files
# RUN mkdir ~/.ssh && ln -s /run/secrets/host_ssh_key ~/.ssh/id_rsa
# RUN ln -s /run/secrets/host_git_config ~/.gitconfig

# Clone repo
# RUN ssh-keyscan ${GIT_HOST} >> ~/.ssh/known_hosts
# RUN git clone git@${GIT_REPO}

CMD "~/.atlassian/asd/setup.sh"